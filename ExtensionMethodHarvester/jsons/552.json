{"Name":"DeleteWithPrejudice and Purge","Description":"These 2 extension method allows you to delete a folder or just purge all the folder content even if there are Readonly, System, and/or Hidden attributes files in it. The default Delete method doesn't work if there are files with Readonly, System, and/or Hidden attributes.","Author":"John Simons","SubmittedOn":"6/17/2010 8:10:31 AM","Entries":["public static void DeleteWithPrejudice(this DirectoryInfo directoryInfo)\r\n        {\r\n            directoryInfo.DeleteWithPrejudice(true);\r\n        }\r\n\r\npublic static void Purge(this DirectoryInfo directoryInfo)\r\n        {\r\n            directoryInfo.DeleteWithPrejudice(false);\r\n        }\r\n\r\n        private static void DeleteWithPrejudice(this DirectoryInfo directoryInfo, bool deleteRoot)\r\n        {\r\n\r\n            /* Determine whether the directory exists */\r\n            if (!directoryInfo.RefreshExists())\r\n            {\r\n                return;\r\n            }\r\n            directoryInfo.Refresh();\r\n            /* Remove Readonly, System, and Hidden attributes prior to deletion */\r\n            directoryInfo.Attributes = FileAttributes.Directory;\r\n\r\n            directoryInfo.DeleteAllFiles(true);\r\n\r\n            var folderPaths = new List<DirectoryInfo>();\r\n\r\n            foreach (var subDirectory in directoryInfo.GetDirectories(\"*\", SearchOption.AllDirectories))\r\n            {\r\n                folderPaths.Add(subDirectory);\r\n            }\r\n            if (deleteRoot)\r\n            {\r\n                folderPaths.Add(directoryInfo);\r\n            }\r\n\r\n            // sort has a side effect that means the deepest directories will be at the top\r\n            folderPaths.Sort((x, y) => y.FullName.CompareTo(x.FullName));\r\n\r\n            foreach (var folderPath in folderPaths)\r\n            {\r\n                if (!folderPath.RefreshExists())\r\n                {\r\n                    continue;\r\n                }\r\n                folderPath.Attributes = directoryInfo.Attributes & ~ReadOnlyHiddenSystemFileAttributes;\r\n                folderPath.Refresh();\r\n                folderPath.Delete();\r\n            }\r\n        }","directoryToDelete.DeleteWithPrejudice();"]}