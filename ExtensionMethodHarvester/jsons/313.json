{"Name":"Load & Save form configuration","Description":"This extension methods allows you to load/save location, size and window state (normal, maximized, minimized) of any form to single XML file at program runtime.","Author":"Marcin Kozub","SubmittedOn":"7/26/2013 11:53:42 AM","Entries":["using System;\r\nusing System.Drawing;\r\nusing System.IO;\r\nusing System.Windows.Forms;\r\nusing System.Xml.Serialization;\r\n\r\nnamespace FormExtensions\r\n{\r\n    [Serializable]\r\n    public class FormSettings\r\n    {\r\n        public FormWindowState WindowState { get; set; }\r\n        public Size Size { get; set; }\r\n        public Point Location { get; set; }\r\n    }\r\n\r\n    public static class FormExtensions\r\n    {\r\n        public static void LoadSettings(this Form form, string path)\r\n        {\r\n            if (File.Exists(path))\r\n            {\r\n                using (var sr = new StreamReader(path))\r\n                {\r\n                    XmlSerializer xmlser = new XmlSerializer(typeof(FormSettings));\r\n                    var formSettings = (FormSettings)xmlser.Deserialize(sr);\r\n                    if (formSettings != null)\r\n                    {\r\n                        form.Size = formSettings.Size;\r\n                        form.Location = formSettings.Location;\r\n                        form.WindowState = formSettings.WindowState;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        public static void SaveSettings(this Form form, string path)\r\n        {\r\n            FormSettings formSettings = new FormSettings();\r\n            formSettings.WindowState = form.WindowState;\r\n            if (form.WindowState == FormWindowState.Normal)\r\n            {\r\n                formSettings.Size = form.Size;\r\n                formSettings.Location = form.Location;\r\n            }\r\n            else\r\n            {\r\n                formSettings.Size = form.RestoreBounds.Size;\r\n                formSettings.Location = form.RestoreBounds.Location;\r\n            }\r\n            using (var sw = new StreamWriter(path))\r\n            {\r\n                XmlSerializer xmlSer = new XmlSerializer(typeof(FormSettings));\r\n                xmlSer.Serialize(sw, formSettings);\r\n            }\r\n        }\r\n    }\r\n}","You can load and save form settings by calling methods directly from any place of code:\r\nfrmInstance.LoadSettings(@\"D:\\form.xml\");\r\nfrmInstance.SaveSattings(@\"D:\\form.xml\");\r\n\r\n...or you can override OnLoad & OnClosed methods of any form to load/save settings automatically:\r\npublic partial class Form1 : Form\r\n{\r\n    public Form1()\r\n    {\r\n        InitializeComponent();\r\n    }\r\n\r\n    //...\r\n    protected override void OnLoad(EventArgs e)\r\n    {\r\n        base.OnLoad(e);\r\n        this.LoadSettings(@\"D:\\form.xml\");\r\n    }\r\n\r\n    protected override void OnClosed(EventArgs e)\r\n    {\r\n        base.OnClosed(e);\r\n        this.SaveSettings(@\"D:\\form.xml\");\r\n    }\r\n    //...\r\n}"]}