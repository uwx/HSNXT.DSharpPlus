# version format
version: uwx-nightly-{build}

# Build worker image (VM template)
image: Visual Studio 2017

clone_folder: c:\projects\dsp

clone_script:
- cmd: git clone -q --recursive --branch=%APPVEYOR_REPO_BRANCH% https://gitlab.com/chrishansen69/TestProject-CSharp.git %APPVEYOR_BUILD_FOLDER%
- cmd: git checkout -qf %APPVEYOR_REPO_COMMIT%

branches:
  only:
    - oh_god

environment:
  access_token:
    secure: ZCGkDJawCLuRgzYTYraor3+u8xB5hjlMC2RhZZYWKkAVWbJ8DBI/ws7qqpZ2c2L1

install:
  - cmd: appveyor downloadfile https://dist.nuget.org/win-x86-commandline/v4.3.0/nuget.exe

before_build:
  - cmd: nuget sources add -Name dsp-myget -Source https://www.myget.org/F/dsharpplus-nightly/api/v3/index.json
  - cmd: nuget restore

build: off

build_script:
  - ps: dotnet build "TestProject.sln" -c Release
  - ps: dotnet publish "TestProject.sln" --configuration Release -f net47
  # publish projects 1
  - ps: dotnet publish "DSharpPlus.CNextNotifier/DSharpPlus.CNextNotifier.csproj" --configuration Release -f netstandard2.0
  - ps: dotnet publish "DSharpPlus.Extended/DSharpPlus.Extended.csproj" --configuration Release -f netstandard2.0
  - ps: dotnet publish "DSharpPlus.Extended.Emoji/DSharpPlus.Extended.Emoji.csproj" --configuration Release -f netstandard2.0
  - ps: dotnet publish "DSharpPlus.ModernEmbedBuilder/DSharpPlus.ModernEmbedBuilder.csproj" --configuration Release -f netstandard2.0
  # set <PackageId> for D#+  projects
  - cmd: node .set-package-id.js "DSharpPlus/DSharpPlus.WebSocket.WebSocket4NetCore/DSharpPlus.WebSocket.WebSocket4NetCore.csproj" HSNXT.DSharpPlus.WebSocket.WebSocket4NetCore
  - cmd: node .set-package-id.js "DSharpPlus/DSharpPlus/DSharpPlus.csproj" HSNXT.DSharpPlus
  - cmd: node .set-package-id.js "DSharpPlus/DSharpPlus.CommandsNext/DSharpPlus.CommandsNext.csproj" HSNXT.DSharpPlus.CommandsNext
  - cmd: node .set-package-id.js "DSharpPlus/DSharpPlus.Interactivity/DSharpPlus.Interactivity.csproj" HSNXT.DSharpPlus.Interactivity
  - cmd: node .set-package-id.js "DSharpPlus/DSharpPlus.Rest/DSharpPlus.Rest.csproj" HSNXT.DSharpPlus.Rest
  - cmd: node .set-package-id.js "DSharpPlus/DSharpPlus.VoiceNext/DSharpPlus.VoiceNext.csproj" HSNXT.DSharpPlus.VoiceNext
  # publish D#+ projects
  #net45;net46;net47;netstandard1.1;netstandard1.3;netstandard2.0
  - ps: dotnet publish "DSharpPlus/DSharpPlus.WebSocket.WebSocket4NetCore/DSharpPlus.WebSocket.WebSocket4NetCore.csproj" --configuration Release -f netstandard1.3
  - ps: dotnet publish "DSharpPlus/DSharpPlus.WebSocket.WebSocket4NetCore/DSharpPlus.WebSocket.WebSocket4NetCore.csproj" --configuration Release -f netstandard2.0
  - ps: dotnet publish "DSharpPlus/DSharpPlus/DSharpPlus.csproj" --configuration Release -f net45
  - ps: dotnet publish "DSharpPlus/DSharpPlus/DSharpPlus.csproj" --configuration Release -f net46
  - ps: dotnet publish "DSharpPlus/DSharpPlus/DSharpPlus.csproj" --configuration Release -f net47
  - ps: dotnet publish "DSharpPlus/DSharpPlus/DSharpPlus.csproj" --configuration Release -f netstandard1.1
  - ps: dotnet publish "DSharpPlus/DSharpPlus/DSharpPlus.csproj" --configuration Release -f netstandard1.3
  - ps: dotnet publish "DSharpPlus/DSharpPlus/DSharpPlus.csproj" --configuration Release -f netstandard2.0
  - ps: dotnet publish "DSharpPlus/DSharpPlus.CommandsNext/DSharpPlus.CommandsNext.csproj" --configuration Release -f net45
  - ps: dotnet publish "DSharpPlus/DSharpPlus.CommandsNext/DSharpPlus.CommandsNext.csproj" --configuration Release -f net46
  - ps: dotnet publish "DSharpPlus/DSharpPlus.CommandsNext/DSharpPlus.CommandsNext.csproj" --configuration Release -f net47
  - ps: dotnet publish "DSharpPlus/DSharpPlus.CommandsNext/DSharpPlus.CommandsNext.csproj" --configuration Release -f netstandard1.1
  - ps: dotnet publish "DSharpPlus/DSharpPlus.CommandsNext/DSharpPlus.CommandsNext.csproj" --configuration Release -f netstandard1.3
  - ps: dotnet publish "DSharpPlus/DSharpPlus.CommandsNext/DSharpPlus.CommandsNext.csproj" --configuration Release -f netstandard2.0
  - ps: dotnet publish "DSharpPlus/DSharpPlus.Interactivity/DSharpPlus.Interactivity.csproj" --configuration Release -f net45
  - ps: dotnet publish "DSharpPlus/DSharpPlus.Interactivity/DSharpPlus.Interactivity.csproj" --configuration Release -f net46
  - ps: dotnet publish "DSharpPlus/DSharpPlus.Interactivity/DSharpPlus.Interactivity.csproj" --configuration Release -f net47
  - ps: dotnet publish "DSharpPlus/DSharpPlus.Interactivity/DSharpPlus.Interactivity.csproj" --configuration Release -f netstandard1.1
  - ps: dotnet publish "DSharpPlus/DSharpPlus.Interactivity/DSharpPlus.Interactivity.csproj" --configuration Release -f netstandard1.3
  - ps: dotnet publish "DSharpPlus/DSharpPlus.Interactivity/DSharpPlus.Interactivity.csproj" --configuration Release -f netstandard2.0
  - ps: dotnet publish "DSharpPlus/DSharpPlus.Rest/DSharpPlus.Rest.csproj" --configuration Release -f net45
  - ps: dotnet publish "DSharpPlus/DSharpPlus.Rest/DSharpPlus.Rest.csproj" --configuration Release -f net46
  - ps: dotnet publish "DSharpPlus/DSharpPlus.Rest/DSharpPlus.Rest.csproj" --configuration Release -f net47
  - ps: dotnet publish "DSharpPlus/DSharpPlus.Rest/DSharpPlus.Rest.csproj" --configuration Release -f netstandard1.1
  - ps: dotnet publish "DSharpPlus/DSharpPlus.Rest/DSharpPlus.Rest.csproj" --configuration Release -f netstandard1.3
  - ps: dotnet publish "DSharpPlus/DSharpPlus.Rest/DSharpPlus.Rest.csproj" --configuration Release -f netstandard2.0
  - ps: dotnet publish "DSharpPlus/DSharpPlus.VoiceNext/DSharpPlus.VoiceNext.csproj" --configuration Release -f net45
  - ps: dotnet publish "DSharpPlus/DSharpPlus.VoiceNext/DSharpPlus.VoiceNext.csproj" --configuration Release -f net46
  - ps: dotnet publish "DSharpPlus/DSharpPlus.VoiceNext/DSharpPlus.VoiceNext.csproj" --configuration Release -f net47
  - ps: dotnet publish "DSharpPlus/DSharpPlus.VoiceNext/DSharpPlus.VoiceNext.csproj" --configuration Release -f netstandard1.1
  - ps: dotnet publish "DSharpPlus/DSharpPlus.VoiceNext/DSharpPlus.VoiceNext.csproj" --configuration Release -f netstandard1.3
  - ps: dotnet publish "DSharpPlus/DSharpPlus.VoiceNext/DSharpPlus.VoiceNext.csproj" --configuration Release -f netstandard2.0
  # pack projects 1
  - ps: dotnet pack "TestProj47/TestProj47.csproj" -c Release -o "Proj1" --no-build
  - ps: dotnet pack "DSharpPlus.CNextNotifier/DSharpPlus.CNextNotifier.csproj" -c Release -o "Proj2" --no-build
  - ps: dotnet pack "DSharpPlus.Extended/DSharpPlus.Extended.csproj" -c Release -o "Proj3" --no-build
  - ps: dotnet pack "DSharpPlus.ModernEmbedBuilder/DSharpPlus.ModernEmbedBuilder.csproj" -c Release -o "Proj4" --no-build
  # pack D#+ projects
  - ps: dotnet pack "DSharpPlus/DSharpPlus.WebSocket.WebSocket4NetCore/DSharpPlus.WebSocket.WebSocket4NetCore.csproj" -c Release -o "DSP1" --no-build
  - ps: dotnet pack "DSharpPlus/DSharpPlus/DSharpPlus.csproj" -c Release -o "DSP2" --no-build
  - ps: dotnet pack "DSharpPlus/DSharpPlus.CommandsNext/DSharpPlus.CommandsNext.csproj" -c Release -o "DSP3" --no-build
  - ps: dotnet pack "DSharpPlus/DSharpPlus.Interactivity/DSharpPlus.Interactivity.csproj" -c Release -o "DSP4" --no-build
  - ps: dotnet pack "DSharpPlus/DSharpPlus.Rest/DSharpPlus.Rest.csproj" -c Release -o "DSP5" --no-build
  - ps: dotnet pack "DSharpPlus/DSharpPlus.VoiceNext/DSharpPlus.VoiceNext.csproj" -c Release -o "DSP6" --no-build
  

artifacts:
  - path: "DSharpPlus\\DSharpPlus.WebSocket.WebSocket4NetCore\\DSP1\\*.nupkg"
  - path: "DSharpPlus\\DSharpPlus\\DSP2\\*.nupkg"
  - path: "DSharpPlus\\DSharpPlus.CommandsNext\\DSP3\\*.nupkg"
  - path: "DSharpPlus\\DSharpPlus.Interactivity\\DSP4\\*.nupkg"
  - path: "DSharpPlus\\DSharpPlus.Rest\\DSP5\\*.nupkg"
  - path: "DSharpPlus\\DSharpPlus.VoiceNext\\DSP6\\*.nupkg"
  
  - path: "TestProj47\\Proj1\\*.nupkg"
  - path: "DSharpPlus.CNextNotifier\\Proj2\\*.nupkg"
  - path: "DSharpPlus.Extended\\Proj3\\*.nupkg"
  - path: "DSharpPlus.ModernEmbedBuilder\\Proj4\\*.nupkg"
  - path: "DSharpPlus.CNextNotifier\\bin\\Release\\netstandard2.0\\*.dll"
    name: DSharpPlus.CNextNotifier Release DLLs (.NET Standard 2.0)
    type: zip
# - path: "ExtensionOverflow\\bin\\Release\\net47\\*.dll"
#   name: ExtensionOverflow Release DLLs (.NET 4.7)
#   type: zip
  - path: "OEISReader\\bin\\Release\\net47\\*.dll"
    name: OEISReader Release DLLs (.NET 4.7)
    type: zip
  - path: "TestProj47\\bin\\Release\\net47\\*.dll"
    name: TestProj47 Release DLLs (.NET 4.7)
    type: zip
# - path: "TestProject2\\bin\\Release\\net47\\*.dll"
#   name: TestProject2 Release DLLs (.NET 4.7)
#   type: zip
  - path: "Wither\\bin\\Release\\net47\\*.dll"
    name: Wither Release DLLs (.NET 4.7)
    type: zip
  - path: "Dickscord\\bin\\Release\\net47\\*.dll"
    name: Dickscord Release DLLs (.NET 4.7)
    type: zip
  - path: "ReflectToArrayTest\\bin\\Release\\net47\\*.dll"
    name: ReflectToArrayTest Release DLLs (.NET 4.7)
    type: zip
  - path: "DRPCTest\\bin\\x64\\Release\\net47\\*.dll"
    name: DRPCTest Release DLLs (.NET 4.7)
    type: zip
  - path: "DSharpPlus\\DSharpPlus\\bin\\Release\\net46"
    name: DSharpPlus Release DLLs (.NET 4.6)
    type: zip
  - path: "DSharpPlus\\DSharpPlus\\bin\\Release\\net47"
    name: DSharpPlus Release DLLs (.NET 4.7)
    type: zip
  - path: "DSharpPlus\\DSharpPlus\\bin\\Release\\netstandard1.1"
    name: DSharpPlus Release DLLs (.NET Standard 1.1)
    type: zip
  - path: "DSharpPlus\\DSharpPlus\\bin\\Release\\netstandard1.3"
    name: DSharpPlus Release DLLs (.NET Standard 1.3)
    type: zip
  - path: "DSharpPlus\\DSharpPlus\\bin\\Release\\netstandard2.0"
    name: DSharpPlus Release DLLs (.NET Standard 2.0)
    type: zip
  - path: "DSharpPlus\\DSharpPlus\\bin\\Release\\net45"
    name: DSharpPlus Release DLLs (.NET 4.5)
    type: zip
  - path: "DSharpPlus.ModernEmbedBuilder\\bin\\Release\\net47"
    name: DSharpPlus.ModernEmbedBuilder Release DLLs (.NET 4.7)
    type: zip
  - path: "DSharpPlus.ModernEmbedBuilder\\bin\\Release\\netstandard2.0"
    name: DSharpPlus.ModernEmbedBuilder Release DLLs (.NET Standard 2.0)
    type: zip
  - path: "BotTest\\bin\\Release"
    name: BotTest Release DLLs
    type: zip
  - path: "DSharpPlus.Extended\\bin\\Release\\netstandard2.0"
    name: DSharpPlus.Extended Release DLLs (.NET Standard 2.0)
    type: zip
  - path: "ExtensionMethodApplier\\bin\\Release\\net47"
    name: ExtensionMethodApplier Release DLLs (.NET 4.7)
    type: zip
  - path: "ExtensionMethodHarvester\\bin\\Release\\netcoreapp2.0"
    name: ExtensionMethodHarvester Release DLLs (.NET Core 2.0)
    type: zip
  - path: "ExtensionMethodHarvester\\bin\\Release\\net47"
    name: ExtensionMethodHarvester Release DLLs (.NET 4.7)
    type: zip
  - path: "RegexesToAssembly\\bin\\Release\\net47"
    name: RegexesToAssembly Release DLLs (.NET 4.7)
    type: zip
  - path: "SuperOEISGenerator\\SuperOEISGenerator\\bin\\Release\\net47"
    name: SuperOEISGenerator Release DLLs (.NET 4.7)
    type: zip
  - path: "TestProject2\\bin\\Release\\netcoreapp2.0"
    name: TestProject2 Release DLLs (.NET Core 2.0)
    type: zip

# Automatically register private account and/or project AppVeyor NuGet feeds.
nuget:
  account_feed: false
  project_feed: false
  disable_publish_on_pr: true     # disable publishing of .nupkg artifacts to account/project feeds for pull request builds

deploy:
  - provider: NuGet
    skip_symbols: false
    api_key:
      secure: ZkuAOJwTjYBiEAHrTHkVDYaNRBaWDDmvpkUVN+9PnsHWQnfDDdDWWAMPltRlYNYn
      
notifications:
  - provider: Slack
    on_build_success: true
    on_build_failure: true
    incoming_webhook:
      secure: /tQzfO0uCSjCMZF2eqIdIGAxeA/Zyn2eKDJKfcnvwV7PsWf0sLZolUFnbnWva3KWtNuYgOXz30QpuRl/fcza4Kp7Ymg7COchmmFXpAPu+ZW/yuY4SiEEgTIRmpLZZFLVlFPOlb+9+JjNvk2Ck6LnWD799g3ErcK7arpJF7O0CrK3Bs/Ib3Qeyigdu7g71Lva